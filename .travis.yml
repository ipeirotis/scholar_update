language: python

python:
- '3.6'

services:
- docker

before_install:
- sudo apt-get install -y tor
- openssl aes-256-cbc -K $encrypted_122ea59d67a5_key -iv $encrypted_122ea59d67a5_iv
  -in google-credentials-scholarAPI.json.enc -out google-credentials-scholarAPI.json
  -d
addons:
  apt:
    update: true  

install:
- pip3 install -r requirements.txt
- pip3 install -U git+https://github.com/OrganicIrradiation/scholarly.git
- python3 fetch_pubs.py

script: 
- echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
- docker build -t ipeirotis/scholar_update .
- docker push ipeirotis/scholar_update
- python3 upload_to_google_storage.py
